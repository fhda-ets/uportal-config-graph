# uPortal Config Graph

## Introduction

_Config graph_ is a project designed with the goal of looking at new ways to manage data and configuration entities for uPortal.

The existing entity system for uPortal has effectively served the needs of portlet deployers for a long period of time. However, should you want to design your own entities beyond what is delivered in core, then the challenge begins. In recent years, the thinking around what makes an ideal product configuration experience has changed significantly. The driving idea for config graph is to take those cutting edge concepts, and distill them into a form that is accessible to the uPortal ecosystem.

**Inspiration / Prior Art:**

- _Understanding Kubernetes Objects:_ https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects/
- _Spring Cloud Config:_ https://spring.io/projects/spring-cloud-config
- Configuration management platforms such as  _Ansible_, _Terraform_, etc.

## Features

- Simple schema uniquely identifies an entity by any kind of type and unique identifier
- Entities have _schemaless_ blocks called graphs which store structured data in any form designed by the portal implementor
- Accessible entirely using REST API
    - Admin API actions for importing and query graphs
    - User API actions getting personalized graphs that can be used in portal frontend design
    - Secured using JWT tokens, ready to use OpenID token generated by uPortal
- Uses existing `portal.home` convention, ingests `uPortal.properties` for shared configuration
- Graph documents can be expressed in JSON or YAML
- Clustered deployment ready using Hazelcast
- Manage graph documents on the command line using Gradle tasks
- Spring Boot application designed for uPortal Start

## What is a Graph?

Below is a real working example written out in YAML.

```yaml
# Named type
type: content

# Unique identifier
fname: students-foothill-website

# Schemaless data block - store whatever you want here, in what whatever structure you prefer
graph:
  content:
    apps:
      app.fhcollegeweb:
        url: https://www.foothill.edu

# ACLs decide how graphs can be used by non-admin users
acls:
  query: "#root['claims']['groups'].contains('Student')"

# Each graph can be assigned key-value tags for querying
tags:
  campus: foothill
```

## Getting Started

### Installation _(for uPortal Start_)

**Note:** At this time, config graph is primarily designed for uPortal implementors using uPortal Start. Let's call it a _preferred_ requirement. However, if you are comfortable working with Gradle and WAR files, then it definitely can work outside of uPortal start.

1. Change into the `overlays` directory
2. Add the config graph repository as a Git submodule: `git submodule add git@github.com:fhda-ets/uportal-config-graph.git config-graph`
3. Add the following `settings.gradle` in your root project following the example below. 

```groovy
// Import config graph submodule
include 'overlays:config-graph:config-graph-core'
project(':overlays:config-graph:config-graph-core').name = 'config-graph'
```

4. Perform a trial build using `./gradlew tomcatDeploy` to ensure that adding config graph does not break your existing project.

### Configuration

When config graph starts up, it expects to find two files in `portal.home`: (1) `config-graph.yml`,  and (2) `config-graph-hz.xml`.

The sample configuration in the `config/simple` directory shows how to set up a simple config graph instance using an embedded HSQL database, and Hazelcast as a single member cluster.

A proper configuration of config graph does not require much effort, and primarily involves picking a primary RDBMS datastore where graph files will be imported for storage and querying. This can be the same as your present uPortal database.

Hazelcast configuration is also straightforward. If you use a set number of uPortal servers with static IPs, then you can specify each node by its address, or if permitted on your network, use multicast discovery. If your environment is dynamic, and you require live discovery of your nodes, then Hazelcast has many options including plugins compatible with major cloud service operators.